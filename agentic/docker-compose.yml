# RedAmon Agent Docker Compose (standalone)
# For full stack, use the root docker-compose.yml instead.
# API keys: set ANTHROPIC_API_KEY / OPENAI_API_KEY / GOOGLE_API_KEY in your environment.

services:
  agent:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: redamon-agent
    ports:
      - "8090:8080"
    environment:
      # Neo4j (via host network)
      NEO4J_URI: bolt://host.docker.internal:7687
      NEO4J_USER: neo4j
      NEO4J_PASSWORD: ${NEO4J_PASSWORD:-changeme123}
      # AI provider keys (from environment)
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
      GOOGLE_API_KEY: ${GOOGLE_API_KEY:-}
      TAVILY_API_KEY: ${TAVILY_API_KEY:-}
      # WebSocket config
      WS_HEARTBEAT_INTERVAL: "30"
      WS_TIMEOUT: "300"
      WS_MAX_MESSAGE_SIZE: "10485760"
      # MCP tool servers (via host network)
      MCP_CURL_URL: http://host.docker.internal:8001/sse
      MCP_NAABU_URL: http://host.docker.internal:8000/sse
      MCP_METASPLOIT_URL: http://host.docker.internal:8003/sse
      MCP_METASPLOIT_PROGRESS_URL: http://host.docker.internal:8013/progress
      # Webapp API (via host network)
      WEBAPP_API_URL: http://host.docker.internal:3000
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - ./logs:/app/logs
      - .:/app
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 60s
      timeout: 60s
      retries: 3
      start_period: 30s
